#pragma once

#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

#ifndef SYNTH_SAMPLE_RATE
  #define SYNTH_SAMPLE_RATE 44100
#endif
#ifndef SYNTH_EXTRA_SHIFT
  #define SYNTH_EXTRA_SHIFT 1
#endif

#define SYNTH_ATTACK_INCR   (int)((1 << 15) / (SYNTH_SAMPLE_RATE * 0.025))
#define SYNTH_RELEASE_INCR  (int)((1 << 15) / (SYNTH_SAMPLE_RATE * 0.075))

static int8_t key_base = 0;
static int8_t scale_base = 0;

// MIDI note:
// Max. 71 + (n + scale_base) (+23 scale degrees, +40) + key_base (+12) + transpose (+1) = 124
// Min. 71 + (n + scale_base) (-18 scale degrees, -31) + key_base (-12) + transpose (-1) = 27

// Period = f_s/f samples = 2^32 in lookup table
// Increment for each sample = 2^32 / (f_s/f)
// note_freq[i] =
//   4294967296.0 * (440.0 * pow(2, (i - 69) / 12.0)) / SYNTH_SAMPLE_RATE
static const uint32_t note_freq[128] = {
  // print('\n'.join('  (uint32_t)(%.4f / SYNTH_SAMPLE_RATE + 0.5),' % (4294967296.0 * (440.0 * (2 ** ((i - 69) / 12.0)))) for i in range(128)))
  (uint32_t)(35114788961.3620 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(37202822970.7782 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(39415017943.5217 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(41758756874.6707 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(44241861775.0361 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(46872619776.3960 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(49659810789.0272 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(52612736803.8398 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(55741252936.9073 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(59055800320.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(62567440946.8918 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(66287894591.7365 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(70229577922.7240 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(74405645941.5564 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(78830035887.0435 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(83517513749.3414 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(88483723550.0722 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(93745239552.7919 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(99319621578.0543 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(105225473607.6797 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(111482505873.8147 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(118111600640.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(125134881893.7837 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(132575789183.4730 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(140459155845.4479 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(148811291883.1128 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(157660071774.0869 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(167035027498.6827 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(176967447100.1444 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(187490479105.5839 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(198639243156.1087 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(210450947215.3594 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(222965011747.6293 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(236223201280.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(250269763787.5674 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(265151578366.9460 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(280918311690.8959 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(297622583766.2255 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(315320143548.1738 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(334070054997.3655 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(353934894200.2888 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(374980958211.1677 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(397278486312.2173 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(420901894430.7188 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(445930023495.2587 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(472446402560.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(500539527575.1349 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(530303156733.8922 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(561836623381.7917 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(595245167532.4510 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(630640287096.3478 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(668140109994.7310 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(707869788400.5775 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(749961916422.3354 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(794556972624.4347 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(841803788861.4374 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(891860046990.5173 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(944892805120.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1001079055150.2698 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1060606313467.7844 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1123673246763.5835 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1190490335064.9021 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1261280574192.6956 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1336280219989.4619 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1415739576801.1550 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1499923832844.6709 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1589113945248.8694 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1683607577722.8748 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1783720093981.0347 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(1889785610240.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2002158110300.5396 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2121212626935.5688 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2247346493527.1670 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2380980670129.8042 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2522561148385.3911 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2672560439978.9238 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2831479153602.3101 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(2999847665689.3418 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(3178227890497.7388 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(3367215155445.7495 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(3567440187962.0693 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(3779571220480.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(4004316220601.0791 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(4242425253871.1377 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(4494692987054.3340 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(4761961340259.6084 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(5045122296770.7822 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(5345120879957.8477 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(5662958307204.6201 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(5999695331378.6836 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(6356455780995.4775 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(6734430310891.4990 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(7134880375924.1387 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(7559142440960.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(8008632441202.1582 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(8484850507742.2734 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(8989385974108.6680 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(9523922680519.2168 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(10090244593541.5625 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(10690241759915.6953 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(11325916614409.2422 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(11999390662757.3672 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(12712911561990.9551 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(13468860621783.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(14269760751848.2773 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(15118284881920.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(16017264882404.3164 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(16969701015484.5469 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(17978771948217.3359 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(19047845361038.4336 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(20180489187083.1250 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(21380483519831.3906 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(22651833228818.4844 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(23998781325514.7344 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(25425823123981.9102 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(26937721243566.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(28539521503696.5547 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(30236569763840.0000 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(32034529764808.6250 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(33939402030969.1094 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(35957543896434.6719 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(38095690722076.8672 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(40360978374166.2656 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(42760967039662.7812 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(45303666457636.9531 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(47997562651029.4766 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(50851646247963.8203 / SYNTH_SAMPLE_RATE + 0.5),
  (uint32_t)(53875442487131.9844 / SYNTH_SAMPLE_RATE + 0.5),
};

static inline uint32_t freq_for_note(int8_t n, int8_t key_base, int8_t transpose)
{
  int octave = (n < 0 ? (n - 6) / 7 : n / 7);
  int degree = n - octave * 7;
  static const uint8_t scale[7] = {0, 2, 4, 5, 7, 9, 11};
  int midi_pitch = 71 + key_base + (octave * 12 + scale[degree]) + transpose;
  return note_freq[midi_pitch];
}

static struct {
  uint32_t freq;
  uint32_t phase;

  uint16_t state; // 0: idle; 1: attack/decay; 2: sustain; 3: release
  uint16_t time;
} keys[10];

static bool last_btn[12] = { 0 };

// Whether a note has been pressed during the time when the transpose key is held
static bool transp_used[2];

#ifdef SYNTH_SINE
static int16_t sine_table[4096] = {
// from math import sin, pi, floor; print(', '.join('%d' % floor(32767.5 * sin(i / 4096.0 * 2 * pi)) for i in range(4096)))
0, 50, 100, 150, 201, 251, 301, 351, 402, 452, 502, 552, 603, 653, 703, 753, 804, 854, 904, 954, 1005, 1055, 1105, 1155, 1206, 1256, 1306, 1356, 1406, 1457, 1507, 1557, 1607, 1658, 1708, 1758, 1808, 1858, 1908, 1959, 2009, 2059, 2109, 2159, 2209, 2260, 2310, 2360, 2410, 2460, 2510, 2560, 2610, 2661, 2711, 2761, 2811, 2861, 2911, 2961, 3011, 3061, 3111, 3161, 3211, 3261, 3311, 3361, 3411, 3461, 3511, 3561, 3611, 3661, 3711, 3761, 3811, 3861, 3911, 3961, 4011, 4060, 4110, 4160, 4210, 4260, 4310, 4360, 4409, 4459, 4509, 4559, 4609, 4658, 4708, 4758, 4807, 4857, 4907, 4957, 5006, 5056, 5106, 5155, 5205, 5255, 5304, 5354, 5403, 5453, 5502, 5552, 5601, 5651, 5701, 5750, 5799, 5849, 5898, 5948, 5997, 6047, 6096, 6145, 6195, 6244, 6293, 6343, 6392, 6441, 6491, 6540, 6589, 6638, 6688, 6737, 6786, 6835, 6884, 6933, 6983, 7032, 7081, 7130, 7179, 7228, 7277, 7326, 7375, 7424, 7473, 7522, 7571, 7620, 7668, 7717, 7766, 7815, 7864, 7913, 7961, 8010, 8059, 8108, 8156, 8205, 8254, 8302, 8351, 8399, 8448, 8497, 8545, 8594, 8642, 8691, 8739, 8787, 8836, 8884, 8933, 8981, 9029, 9078, 9126, 9174, 9222, 9271, 9319, 9367, 9415, 9463, 9511, 9559, 9608, 9656, 9704, 9752, 9800, 9848, 9895, 9943, 9991, 10039, 10087, 10135, 10183, 10230, 10278, 10326, 10373, 10421, 10469, 10516, 10564, 10612, 10659, 10707, 10754, 10802, 10849, 10896, 10944, 10991, 11039, 11086, 11133, 11180, 11228, 11275, 11322, 11369, 11416, 11463, 11510, 11558, 11605, 11652, 11699, 11745, 11792, 11839, 11886, 11933, 11980, 12026, 12073, 12120, 12167, 12213, 12260, 12307, 12353, 12400, 12446, 12493, 12539, 12586, 12632, 12678, 12725, 12771, 12817, 12863, 12910, 12956, 13002, 13048, 13094, 13140, 13186, 13232, 13278, 13324, 13370, 13416, 13462, 13508, 13553, 13599, 13645, 13691, 13736, 13782, 13827, 13873, 13918, 13964, 14009, 14055, 14100, 14146, 14191, 14236, 14281, 14327, 14372, 14417, 14462, 14507, 14552, 14597, 14642, 14687, 14732, 14777, 14822, 14867, 14911, 14956, 15001, 15046, 15090, 15135, 15179, 15224, 15268, 15313, 15357, 15402, 15446, 15490, 15535, 15579, 15623, 15667, 15711, 15755, 15799, 15843, 15887, 15931, 15975, 16019, 16063, 16107, 16151, 16194, 16238, 16282, 16325, 16369, 16412, 16456, 16499, 16543, 16586, 16629, 16673, 16716, 16759, 16802, 16845, 16888, 16932, 16975, 17017, 17060, 17103, 17146, 17189, 17232, 17274, 17317, 17360, 17402, 17445, 17488, 17530, 17572, 17615, 17657, 17700, 17742, 17784, 17826, 17868, 17911, 17953, 17995, 18037, 18079, 18120, 18162, 18204, 18246, 18288, 18329, 18371, 18413, 18454, 18496, 18537, 18579, 18620, 18661, 18703, 18744, 18785, 18826, 18867, 18908, 18949, 18990, 19031, 19072, 19113, 19154, 19195, 19235, 19276, 19317, 19357, 19398, 19438, 19479, 19519, 19559, 19600, 19640, 19680, 19720, 19760, 19801, 19841, 19881, 19920, 19960, 20000, 20040, 20080, 20119, 20159, 20199, 20238, 20278, 20317, 20357, 20396, 20435, 20475, 20514, 20553, 20592, 20631, 20670, 20709, 20748, 20787, 20826, 20865, 20903, 20942, 20981, 21019, 21058, 21096, 21135, 21173, 21211, 21250, 21288, 21326, 21364, 21402, 21440, 21478, 21516, 21554, 21592, 21630, 21668, 21705, 21743, 21780, 21818, 21855, 21893, 21930, 21968, 22005, 22042, 22079, 22116, 22153, 22190, 22227, 22264, 22301, 22338, 22375, 22411, 22448, 22485, 22521, 22558, 22594, 22630, 22667, 22703, 22739, 22775, 22811, 22848, 22884, 22919, 22955, 22991, 23027, 23063, 23098, 23134, 23170, 23205, 23241, 23276, 23311, 23347, 23382, 23417, 23452, 23487, 23522, 23557, 23592, 23627, 23662, 23697, 23731, 23766, 23800, 23835, 23869, 23904, 23938, 23973, 24007, 24041, 24075, 24109, 24143, 24177, 24211, 24245, 24279, 24312, 24346, 24380, 24413, 24447, 24480, 24514, 24547, 24580, 24613, 24646, 24680, 24713, 24746, 24778, 24811, 24844, 24877, 24910, 24942, 24975, 25007, 25040, 25072, 25104, 25137, 25169, 25201, 25233, 25265, 25297, 25329, 25361, 25393, 25425, 25456, 25488, 25519, 25551, 25582, 25614, 25645, 25676, 25707, 25739, 25770, 25801, 25832, 25863, 25893, 25924, 25955, 25986, 26016, 26047, 26077, 26107, 26138, 26168, 26198, 26228, 26259, 26289, 26319, 26349, 26378, 26408, 26438, 26468, 26497, 26527, 26556, 26586, 26615, 26644, 26673, 26703, 26732, 26761, 26790, 26819, 26847, 26876, 26905, 26934, 26962, 26991, 27019, 27048, 27076, 27104, 27132, 27161, 27189, 27217, 27245, 27273, 27300, 27328, 27356, 27384, 27411, 27439, 27466, 27493, 27521, 27548, 27575, 27602, 27629, 27656, 27683, 27710, 27737, 27764, 27790, 27817, 27843, 27870, 27896, 27923, 27949, 27975, 28001, 28027, 28053, 28079, 28105, 28131, 28157, 28182, 28208, 28234, 28259, 28284, 28310, 28335, 28360, 28385, 28410, 28435, 28460, 28485, 28510, 28535, 28559, 28584, 28609, 28633, 28658, 28682, 28706, 28730, 28754, 28779, 28803, 28826, 28850, 28874, 28898, 28922, 28945, 28969, 28992, 29015, 29039, 29062, 29085, 29108, 29131, 29154, 29177, 29200, 29223, 29246, 29268, 29291, 29313, 29336, 29358, 29380, 29403, 29425, 29447, 29469, 29491, 29513, 29534, 29556, 29578, 29599, 29621, 29642, 29664, 29685, 29706, 29728, 29749, 29770, 29791, 29812, 29832, 29853, 29874, 29894, 29915, 29935, 29956, 29976, 29996, 30017, 30037, 30057, 30077, 30097, 30117, 30136, 30156, 30176, 30195, 30215, 30234, 30253, 30273, 30292, 30311, 30330, 30349, 30368, 30387, 30406, 30424, 30443, 30462, 30480, 30498, 30517, 30535, 30553, 30571, 30589, 30607, 30625, 30643, 30661, 30679, 30696, 30714, 30731, 30749, 30766, 30783, 30800, 30818, 30835, 30852, 30868, 30885, 30902, 30919, 30935, 30952, 30968, 30985, 31001, 31017, 31033, 31050, 31066, 31081, 31097, 31113, 31129, 31145, 31160, 31176, 31191, 31206, 31222, 31237, 31252, 31267, 31282, 31297, 31312, 31327, 31341, 31356, 31371, 31385, 31399, 31414, 31428, 31442, 31456, 31470, 31484, 31498, 31512, 31526, 31539, 31553, 31567, 31580, 31593, 31607, 31620, 31633, 31646, 31659, 31672, 31685, 31698, 31710, 31723, 31736, 31748, 31760, 31773, 31785, 31797, 31809, 31821, 31833, 31845, 31857, 31869, 31880, 31892, 31903, 31915, 31926, 31937, 31949, 31960, 31971, 31982, 31993, 32004, 32014, 32025, 32036, 32046, 32057, 32067, 32077, 32087, 32098, 32108, 32118, 32128, 32137, 32147, 32157, 32166, 32176, 32185, 32195, 32204, 32213, 32223, 32232, 32241, 32250, 32258, 32267, 32276, 32285, 32293, 32302, 32310, 32318, 32327, 32335, 32343, 32351, 32359, 32367, 32375, 32382, 32390, 32397, 32405, 32412, 32420, 32427, 32434, 32441, 32448, 32455, 32462, 32469, 32476, 32482, 32489, 32495, 32502, 32508, 32514, 32521, 32527, 32533, 32539, 32545, 32550, 32556, 32562, 32567, 32573, 32578, 32584, 32589, 32594, 32599, 32604, 32609, 32614, 32619, 32624, 32628, 32633, 32637, 32642, 32646, 32650, 32655, 32659, 32663, 32667, 32671, 32674, 32678, 32682, 32685, 32689, 32692, 32696, 32699, 32702, 32705, 32708, 32711, 32714, 32717, 32720, 32722, 32725, 32728, 32730, 32732, 32735, 32737, 32739, 32741, 32743, 32745, 32747, 32748, 32750, 32752, 32753, 32755, 32756, 32757, 32758, 32759, 32760, 32761, 32762, 32763, 32764, 32765, 32765, 32766, 32766, 32766, 32767, 32767, 32767, 32767, 32767, 32767, 32767, 32766, 32766, 32766, 32765, 32765, 32764, 32763, 32762, 32761, 32760, 32759, 32758, 32757, 32756, 32755, 32753, 32752, 32750, 32748, 32747, 32745, 32743, 32741, 32739, 32737, 32735, 32732, 32730, 32728, 32725, 32722, 32720, 32717, 32714, 32711, 32708, 32705, 32702, 32699, 32696, 32692, 32689, 32685, 32682, 32678, 32674, 32671, 32667, 32663, 32659, 32655, 32650, 32646, 32642, 32637, 32633, 32628, 32624, 32619, 32614, 32609, 32604, 32599, 32594, 32589, 32584, 32578, 32573, 32567, 32562, 32556, 32550, 32545, 32539, 32533, 32527, 32521, 32514, 32508, 32502, 32495, 32489, 32482, 32476, 32469, 32462, 32455, 32448, 32441, 32434, 32427, 32420, 32412, 32405, 32397, 32390, 32382, 32375, 32367, 32359, 32351, 32343, 32335, 32327, 32318, 32310, 32302, 32293, 32285, 32276, 32267, 32258, 32250, 32241, 32232, 32223, 32213, 32204, 32195, 32185, 32176, 32166, 32157, 32147, 32137, 32128, 32118, 32108, 32098, 32087, 32077, 32067, 32057, 32046, 32036, 32025, 32014, 32004, 31993, 31982, 31971, 31960, 31949, 31937, 31926, 31915, 31903, 31892, 31880, 31869, 31857, 31845, 31833, 31821, 31809, 31797, 31785, 31773, 31760, 31748, 31736, 31723, 31710, 31698, 31685, 31672, 31659, 31646, 31633, 31620, 31607, 31593, 31580, 31567, 31553, 31539, 31526, 31512, 31498, 31484, 31470, 31456, 31442, 31428, 31414, 31399, 31385, 31371, 31356, 31341, 31327, 31312, 31297, 31282, 31267, 31252, 31237, 31222, 31206, 31191, 31176, 31160, 31145, 31129, 31113, 31097, 31081, 31066, 31050, 31033, 31017, 31001, 30985, 30968, 30952, 30935, 30919, 30902, 30885, 30868, 30852, 30835, 30818, 30800, 30783, 30766, 30749, 30731, 30714, 30696, 30679, 30661, 30643, 30625, 30607, 30589, 30571, 30553, 30535, 30517, 30498, 30480, 30462, 30443, 30424, 30406, 30387, 30368, 30349, 30330, 30311, 30292, 30273, 30253, 30234, 30215, 30195, 30176, 30156, 30136, 30117, 30097, 30077, 30057, 30037, 30017, 29996, 29976, 29956, 29935, 29915, 29894, 29874, 29853, 29832, 29812, 29791, 29770, 29749, 29728, 29706, 29685, 29664, 29642, 29621, 29599, 29578, 29556, 29534, 29513, 29491, 29469, 29447, 29425, 29403, 29380, 29358, 29336, 29313, 29291, 29268, 29246, 29223, 29200, 29177, 29154, 29131, 29108, 29085, 29062, 29039, 29015, 28992, 28969, 28945, 28922, 28898, 28874, 28850, 28826, 28803, 28779, 28754, 28730, 28706, 28682, 28658, 28633, 28609, 28584, 28559, 28535, 28510, 28485, 28460, 28435, 28410, 28385, 28360, 28335, 28310, 28284, 28259, 28234, 28208, 28182, 28157, 28131, 28105, 28079, 28053, 28027, 28001, 27975, 27949, 27923, 27896, 27870, 27843, 27817, 27790, 27764, 27737, 27710, 27683, 27656, 27629, 27602, 27575, 27548, 27521, 27493, 27466, 27439, 27411, 27384, 27356, 27328, 27300, 27273, 27245, 27217, 27189, 27161, 27132, 27104, 27076, 27048, 27019, 26991, 26962, 26934, 26905, 26876, 26847, 26819, 26790, 26761, 26732, 26703, 26673, 26644, 26615, 26586, 26556, 26527, 26497, 26468, 26438, 26408, 26378, 26349, 26319, 26289, 26259, 26228, 26198, 26168, 26138, 26107, 26077, 26047, 26016, 25986, 25955, 25924, 25893, 25863, 25832, 25801, 25770, 25739, 25707, 25676, 25645, 25614, 25582, 25551, 25519, 25488, 25456, 25425, 25393, 25361, 25329, 25297, 25265, 25233, 25201, 25169, 25137, 25104, 25072, 25040, 25007, 24975, 24942, 24910, 24877, 24844, 24811, 24778, 24746, 24713, 24680, 24646, 24613, 24580, 24547, 24514, 24480, 24447, 24413, 24380, 24346, 24312, 24279, 24245, 24211, 24177, 24143, 24109, 24075, 24041, 24007, 23973, 23938, 23904, 23869, 23835, 23800, 23766, 23731, 23697, 23662, 23627, 23592, 23557, 23522, 23487, 23452, 23417, 23382, 23347, 23311, 23276, 23241, 23205, 23170, 23134, 23098, 23063, 23027, 22991, 22955, 22919, 22884, 22848, 22811, 22775, 22739, 22703, 22667, 22630, 22594, 22558, 22521, 22485, 22448, 22411, 22375, 22338, 22301, 22264, 22227, 22190, 22153, 22116, 22079, 22042, 22005, 21968, 21930, 21893, 21855, 21818, 21780, 21743, 21705, 21668, 21630, 21592, 21554, 21516, 21478, 21440, 21402, 21364, 21326, 21288, 21250, 21211, 21173, 21135, 21096, 21058, 21019, 20981, 20942, 20903, 20865, 20826, 20787, 20748, 20709, 20670, 20631, 20592, 20553, 20514, 20475, 20435, 20396, 20357, 20317, 20278, 20238, 20199, 20159, 20119, 20080, 20040, 20000, 19960, 19920, 19881, 19841, 19801, 19760, 19720, 19680, 19640, 19600, 19559, 19519, 19479, 19438, 19398, 19357, 19317, 19276, 19235, 19195, 19154, 19113, 19072, 19031, 18990, 18949, 18908, 18867, 18826, 18785, 18744, 18703, 18661, 18620, 18579, 18537, 18496, 18454, 18413, 18371, 18329, 18288, 18246, 18204, 18162, 18120, 18079, 18037, 17995, 17953, 17911, 17868, 17826, 17784, 17742, 17700, 17657, 17615, 17572, 17530, 17488, 17445, 17402, 17360, 17317, 17274, 17232, 17189, 17146, 17103, 17060, 17017, 16975, 16932, 16888, 16845, 16802, 16759, 16716, 16673, 16629, 16586, 16543, 16499, 16456, 16412, 16369, 16325, 16282, 16238, 16194, 16151, 16107, 16063, 16019, 15975, 15931, 15887, 15843, 15799, 15755, 15711, 15667, 15623, 15579, 15535, 15490, 15446, 15402, 15357, 15313, 15268, 15224, 15179, 15135, 15090, 15046, 15001, 14956, 14911, 14867, 14822, 14777, 14732, 14687, 14642, 14597, 14552, 14507, 14462, 14417, 14372, 14327, 14281, 14236, 14191, 14146, 14100, 14055, 14009, 13964, 13918, 13873, 13827, 13782, 13736, 13691, 13645, 13599, 13553, 13508, 13462, 13416, 13370, 13324, 13278, 13232, 13186, 13140, 13094, 13048, 13002, 12956, 12910, 12863, 12817, 12771, 12725, 12678, 12632, 12586, 12539, 12493, 12446, 12400, 12353, 12307, 12260, 12213, 12167, 12120, 12073, 12026, 11980, 11933, 11886, 11839, 11792, 11745, 11699, 11652, 11605, 11558, 11510, 11463, 11416, 11369, 11322, 11275, 11228, 11180, 11133, 11086, 11039, 10991, 10944, 10896, 10849, 10802, 10754, 10707, 10659, 10612, 10564, 10516, 10469, 10421, 10373, 10326, 10278, 10230, 10183, 10135, 10087, 10039, 9991, 9943, 9895, 9848, 9800, 9752, 9704, 9656, 9608, 9559, 9511, 9463, 9415, 9367, 9319, 9271, 9222, 9174, 9126, 9078, 9029, 8981, 8933, 8884, 8836, 8787, 8739, 8691, 8642, 8594, 8545, 8497, 8448, 8399, 8351, 8302, 8254, 8205, 8156, 8108, 8059, 8010, 7961, 7913, 7864, 7815, 7766, 7717, 7668, 7620, 7571, 7522, 7473, 7424, 7375, 7326, 7277, 7228, 7179, 7130, 7081, 7032, 6983, 6933, 6884, 6835, 6786, 6737, 6688, 6638, 6589, 6540, 6491, 6441, 6392, 6343, 6293, 6244, 6195, 6145, 6096, 6047, 5997, 5948, 5898, 5849, 5799, 5750, 5701, 5651, 5601, 5552, 5502, 5453, 5403, 5354, 5304, 5255, 5205, 5155, 5106, 5056, 5006, 4957, 4907, 4857, 4807, 4758, 4708, 4658, 4609, 4559, 4509, 4459, 4409, 4360, 4310, 4260, 4210, 4160, 4110, 4060, 4011, 3961, 3911, 3861, 3811, 3761, 3711, 3661, 3611, 3561, 3511, 3461, 3411, 3361, 3311, 3261, 3211, 3161, 3111, 3061, 3011, 2961, 2911, 2861, 2811, 2761, 2711, 2661, 2610, 2560, 2510, 2460, 2410, 2360, 2310, 2260, 2209, 2159, 2109, 2059, 2009, 1959, 1908, 1858, 1808, 1758, 1708, 1658, 1607, 1557, 1507, 1457, 1406, 1356, 1306, 1256, 1206, 1155, 1105, 1055, 1005, 954, 904, 854, 804, 753, 703, 653, 603, 552, 502, 452, 402, 351, 301, 251, 201, 150, 100, 50, 0, -51, -101, -151, -202, -252, -302, -352, -403, -453, -503, -553, -604, -654, -704, -754, -805, -855, -905, -955, -1006, -1056, -1106, -1156, -1207, -1257, -1307, -1357, -1407, -1458, -1508, -1558, -1608, -1659, -1709, -1759, -1809, -1859, -1909, -1960, -2010, -2060, -2110, -2160, -2210, -2261, -2311, -2361, -2411, -2461, -2511, -2561, -2611, -2662, -2712, -2762, -2812, -2862, -2912, -2962, -3012, -3062, -3112, -3162, -3212, -3262, -3312, -3362, -3412, -3462, -3512, -3562, -3612, -3662, -3712, -3762, -3812, -3862, -3912, -3962, -4012, -4061, -4111, -4161, -4211, -4261, -4311, -4361, -4410, -4460, -4510, -4560, -4610, -4659, -4709, -4759, -4808, -4858, -4908, -4958, -5007, -5057, -5107, -5156, -5206, -5256, -5305, -5355, -5404, -5454, -5503, -5553, -5602, -5652, -5702, -5751, -5800, -5850, -5899, -5949, -5998, -6048, -6097, -6146, -6196, -6245, -6294, -6344, -6393, -6442, -6492, -6541, -6590, -6639, -6689, -6738, -6787, -6836, -6885, -6934, -6984, -7033, -7082, -7131, -7180, -7229, -7278, -7327, -7376, -7425, -7474, -7523, -7572, -7621, -7669, -7718, -7767, -7816, -7865, -7914, -7962, -8011, -8060, -8109, -8157, -8206, -8255, -8303, -8352, -8400, -8449, -8498, -8546, -8595, -8643, -8692, -8740, -8788, -8837, -8885, -8934, -8982, -9030, -9079, -9127, -9175, -9223, -9272, -9320, -9368, -9416, -9464, -9512, -9560, -9609, -9657, -9705, -9753, -9801, -9849, -9896, -9944, -9992, -10040, -10088, -10136, -10184, -10231, -10279, -10327, -10374, -10422, -10470, -10517, -10565, -10613, -10660, -10708, -10755, -10803, -10850, -10897, -10945, -10992, -11040, -11087, -11134, -11181, -11229, -11276, -11323, -11370, -11417, -11464, -11511, -11559, -11606, -11653, -11700, -11746, -11793, -11840, -11887, -11934, -11981, -12027, -12074, -12121, -12168, -12214, -12261, -12308, -12354, -12401, -12447, -12494, -12540, -12587, -12633, -12679, -12726, -12772, -12818, -12864, -12911, -12957, -13003, -13049, -13095, -13141, -13187, -13233, -13279, -13325, -13371, -13417, -13463, -13509, -13554, -13600, -13646, -13692, -13737, -13783, -13828, -13874, -13919, -13965, -14010, -14056, -14101, -14147, -14192, -14237, -14282, -14328, -14373, -14418, -14463, -14508, -14553, -14598, -14643, -14688, -14733, -14778, -14823, -14868, -14912, -14957, -15002, -15047, -15091, -15136, -15180, -15225, -15269, -15314, -15358, -15403, -15447, -15491, -15536, -15580, -15624, -15668, -15712, -15756, -15800, -15844, -15888, -15932, -15976, -16020, -16064, -16108, -16152, -16195, -16239, -16283, -16326, -16370, -16413, -16457, -16500, -16544, -16587, -16630, -16674, -16717, -16760, -16803, -16846, -16889, -16933, -16976, -17018, -17061, -17104, -17147, -17190, -17233, -17275, -17318, -17361, -17403, -17446, -17489, -17531, -17573, -17616, -17658, -17701, -17743, -17785, -17827, -17869, -17912, -17954, -17996, -18038, -18080, -18121, -18163, -18205, -18247, -18289, -18330, -18372, -18414, -18455, -18497, -18538, -18580, -18621, -18662, -18704, -18745, -18786, -18827, -18868, -18909, -18950, -18991, -19032, -19073, -19114, -19155, -19196, -19236, -19277, -19318, -19358, -19399, -19439, -19480, -19520, -19560, -19601, -19641, -19681, -19721, -19761, -19802, -19842, -19882, -19921, -19961, -20001, -20041, -20081, -20120, -20160, -20200, -20239, -20279, -20318, -20358, -20397, -20436, -20476, -20515, -20554, -20593, -20632, -20671, -20710, -20749, -20788, -20827, -20866, -20904, -20943, -20982, -21020, -21059, -21097, -21136, -21174, -21212, -21251, -21289, -21327, -21365, -21403, -21441, -21479, -21517, -21555, -21593, -21631, -21669, -21706, -21744, -21781, -21819, -21856, -21894, -21931, -21969, -22006, -22043, -22080, -22117, -22154, -22191, -22228, -22265, -22302, -22339, -22376, -22412, -22449, -22486, -22522, -22559, -22595, -22631, -22668, -22704, -22740, -22776, -22812, -22849, -22885, -22920, -22956, -22992, -23028, -23064, -23099, -23135, -23171, -23206, -23242, -23277, -23312, -23348, -23383, -23418, -23453, -23488, -23523, -23558, -23593, -23628, -23663, -23698, -23732, -23767, -23801, -23836, -23870, -23905, -23939, -23974, -24008, -24042, -24076, -24110, -24144, -24178, -24212, -24246, -24280, -24313, -24347, -24381, -24414, -24448, -24481, -24515, -24548, -24581, -24614, -24647, -24681, -24714, -24747, -24779, -24812, -24845, -24878, -24911, -24943, -24976, -25008, -25041, -25073, -25105, -25138, -25170, -25202, -25234, -25266, -25298, -25330, -25362, -25394, -25426, -25457, -25489, -25520, -25552, -25583, -25615, -25646, -25677, -25708, -25740, -25771, -25802, -25833, -25864, -25894, -25925, -25956, -25987, -26017, -26048, -26078, -26108, -26139, -26169, -26199, -26229, -26260, -26290, -26320, -26350, -26379, -26409, -26439, -26469, -26498, -26528, -26557, -26587, -26616, -26645, -26674, -26704, -26733, -26762, -26791, -26820, -26848, -26877, -26906, -26935, -26963, -26992, -27020, -27049, -27077, -27105, -27133, -27162, -27190, -27218, -27246, -27274, -27301, -27329, -27357, -27385, -27412, -27440, -27467, -27494, -27522, -27549, -27576, -27603, -27630, -27657, -27684, -27711, -27738, -27765, -27791, -27818, -27844, -27871, -27897, -27924, -27950, -27976, -28002, -28028, -28054, -28080, -28106, -28132, -28158, -28183, -28209, -28235, -28260, -28285, -28311, -28336, -28361, -28386, -28411, -28436, -28461, -28486, -28511, -28536, -28560, -28585, -28610, -28634, -28659, -28683, -28707, -28731, -28755, -28780, -28804, -28827, -28851, -28875, -28899, -28923, -28946, -28970, -28993, -29016, -29040, -29063, -29086, -29109, -29132, -29155, -29178, -29201, -29224, -29247, -29269, -29292, -29314, -29337, -29359, -29381, -29404, -29426, -29448, -29470, -29492, -29514, -29535, -29557, -29579, -29600, -29622, -29643, -29665, -29686, -29707, -29729, -29750, -29771, -29792, -29813, -29833, -29854, -29875, -29895, -29916, -29936, -29957, -29977, -29997, -30018, -30038, -30058, -30078, -30098, -30118, -30137, -30157, -30177, -30196, -30216, -30235, -30254, -30274, -30293, -30312, -30331, -30350, -30369, -30388, -30407, -30425, -30444, -30463, -30481, -30499, -30518, -30536, -30554, -30572, -30590, -30608, -30626, -30644, -30662, -30680, -30697, -30715, -30732, -30750, -30767, -30784, -30801, -30819, -30836, -30853, -30869, -30886, -30903, -30920, -30936, -30953, -30969, -30986, -31002, -31018, -31034, -31051, -31067, -31082, -31098, -31114, -31130, -31146, -31161, -31177, -31192, -31207, -31223, -31238, -31253, -31268, -31283, -31298, -31313, -31328, -31342, -31357, -31372, -31386, -31400, -31415, -31429, -31443, -31457, -31471, -31485, -31499, -31513, -31527, -31540, -31554, -31568, -31581, -31594, -31608, -31621, -31634, -31647, -31660, -31673, -31686, -31699, -31711, -31724, -31737, -31749, -31761, -31774, -31786, -31798, -31810, -31822, -31834, -31846, -31858, -31870, -31881, -31893, -31904, -31916, -31927, -31938, -31950, -31961, -31972, -31983, -31994, -32005, -32015, -32026, -32037, -32047, -32058, -32068, -32078, -32088, -32099, -32109, -32119, -32129, -32138, -32148, -32158, -32167, -32177, -32186, -32196, -32205, -32214, -32224, -32233, -32242, -32251, -32259, -32268, -32277, -32286, -32294, -32303, -32311, -32319, -32328, -32336, -32344, -32352, -32360, -32368, -32376, -32383, -32391, -32398, -32406, -32413, -32421, -32428, -32435, -32442, -32449, -32456, -32463, -32470, -32477, -32483, -32490, -32496, -32503, -32509, -32515, -32522, -32528, -32534, -32540, -32546, -32551, -32557, -32563, -32568, -32574, -32579, -32585, -32590, -32595, -32600, -32605, -32610, -32615, -32620, -32625, -32629, -32634, -32638, -32643, -32647, -32651, -32656, -32660, -32664, -32668, -32672, -32675, -32679, -32683, -32686, -32690, -32693, -32697, -32700, -32703, -32706, -32709, -32712, -32715, -32718, -32721, -32723, -32726, -32729, -32731, -32733, -32736, -32738, -32740, -32742, -32744, -32746, -32748, -32749, -32751, -32753, -32754, -32756, -32757, -32758, -32759, -32760, -32761, -32762, -32763, -32764, -32765, -32766, -32766, -32767, -32767, -32767, -32768, -32768, -32768, -32768, -32768, -32768, -32768, -32767, -32767, -32767, -32766, -32766, -32765, -32764, -32763, -32762, -32761, -32760, -32759, -32758, -32757, -32756, -32754, -32753, -32751, -32749, -32748, -32746, -32744, -32742, -32740, -32738, -32736, -32733, -32731, -32729, -32726, -32723, -32721, -32718, -32715, -32712, -32709, -32706, -32703, -32700, -32697, -32693, -32690, -32686, -32683, -32679, -32675, -32672, -32668, -32664, -32660, -32656, -32651, -32647, -32643, -32638, -32634, -32629, -32625, -32620, -32615, -32610, -32605, -32600, -32595, -32590, -32585, -32579, -32574, -32568, -32563, -32557, -32551, -32546, -32540, -32534, -32528, -32522, -32515, -32509, -32503, -32496, -32490, -32483, -32477, -32470, -32463, -32456, -32449, -32442, -32435, -32428, -32421, -32413, -32406, -32398, -32391, -32383, -32376, -32368, -32360, -32352, -32344, -32336, -32328, -32319, -32311, -32303, -32294, -32286, -32277, -32268, -32259, -32251, -32242, -32233, -32224, -32214, -32205, -32196, -32186, -32177, -32167, -32158, -32148, -32138, -32129, -32119, -32109, -32099, -32088, -32078, -32068, -32058, -32047, -32037, -32026, -32015, -32005, -31994, -31983, -31972, -31961, -31950, -31938, -31927, -31916, -31904, -31893, -31881, -31870, -31858, -31846, -31834, -31822, -31810, -31798, -31786, -31774, -31761, -31749, -31737, -31724, -31711, -31699, -31686, -31673, -31660, -31647, -31634, -31621, -31608, -31594, -31581, -31568, -31554, -31540, -31527, -31513, -31499, -31485, -31471, -31457, -31443, -31429, -31415, -31400, -31386, -31372, -31357, -31342, -31328, -31313, -31298, -31283, -31268, -31253, -31238, -31223, -31207, -31192, -31177, -31161, -31146, -31130, -31114, -31098, -31082, -31067, -31051, -31034, -31018, -31002, -30986, -30969, -30953, -30936, -30920, -30903, -30886, -30869, -30853, -30836, -30819, -30801, -30784, -30767, -30750, -30732, -30715, -30697, -30680, -30662, -30644, -30626, -30608, -30590, -30572, -30554, -30536, -30518, -30499, -30481, -30463, -30444, -30425, -30407, -30388, -30369, -30350, -30331, -30312, -30293, -30274, -30254, -30235, -30216, -30196, -30177, -30157, -30137, -30118, -30098, -30078, -30058, -30038, -30018, -29997, -29977, -29957, -29936, -29916, -29895, -29875, -29854, -29833, -29813, -29792, -29771, -29750, -29729, -29707, -29686, -29665, -29643, -29622, -29600, -29579, -29557, -29535, -29514, -29492, -29470, -29448, -29426, -29404, -29381, -29359, -29337, -29314, -29292, -29269, -29247, -29224, -29201, -29178, -29155, -29132, -29109, -29086, -29063, -29040, -29016, -28993, -28970, -28946, -28923, -28899, -28875, -28851, -28827, -28804, -28780, -28755, -28731, -28707, -28683, -28659, -28634, -28610, -28585, -28560, -28536, -28511, -28486, -28461, -28436, -28411, -28386, -28361, -28336, -28311, -28285, -28260, -28235, -28209, -28183, -28158, -28132, -28106, -28080, -28054, -28028, -28002, -27976, -27950, -27924, -27897, -27871, -27844, -27818, -27791, -27765, -27738, -27711, -27684, -27657, -27630, -27603, -27576, -27549, -27522, -27494, -27467, -27440, -27412, -27385, -27357, -27329, -27301, -27274, -27246, -27218, -27190, -27162, -27133, -27105, -27077, -27049, -27020, -26992, -26963, -26935, -26906, -26877, -26848, -26820, -26791, -26762, -26733, -26704, -26674, -26645, -26616, -26587, -26557, -26528, -26498, -26469, -26439, -26409, -26379, -26350, -26320, -26290, -26260, -26229, -26199, -26169, -26139, -26108, -26078, -26048, -26017, -25987, -25956, -25925, -25894, -25864, -25833, -25802, -25771, -25740, -25708, -25677, -25646, -25615, -25583, -25552, -25520, -25489, -25457, -25426, -25394, -25362, -25330, -25298, -25266, -25234, -25202, -25170, -25138, -25105, -25073, -25041, -25008, -24976, -24943, -24911, -24878, -24845, -24812, -24779, -24747, -24714, -24681, -24647, -24614, -24581, -24548, -24515, -24481, -24448, -24414, -24381, -24347, -24313, -24280, -24246, -24212, -24178, -24144, -24110, -24076, -24042, -24008, -23974, -23939, -23905, -23870, -23836, -23801, -23767, -23732, -23698, -23663, -23628, -23593, -23558, -23523, -23488, -23453, -23418, -23383, -23348, -23312, -23277, -23242, -23206, -23171, -23135, -23099, -23064, -23028, -22992, -22956, -22920, -22885, -22849, -22812, -22776, -22740, -22704, -22668, -22631, -22595, -22559, -22522, -22486, -22449, -22412, -22376, -22339, -22302, -22265, -22228, -22191, -22154, -22117, -22080, -22043, -22006, -21969, -21931, -21894, -21856, -21819, -21781, -21744, -21706, -21669, -21631, -21593, -21555, -21517, -21479, -21441, -21403, -21365, -21327, -21289, -21251, -21212, -21174, -21136, -21097, -21059, -21020, -20982, -20943, -20904, -20866, -20827, -20788, -20749, -20710, -20671, -20632, -20593, -20554, -20515, -20476, -20436, -20397, -20358, -20318, -20279, -20239, -20200, -20160, -20120, -20081, -20041, -20001, -19961, -19921, -19882, -19842, -19802, -19761, -19721, -19681, -19641, -19601, -19560, -19520, -19480, -19439, -19399, -19358, -19318, -19277, -19236, -19196, -19155, -19114, -19073, -19032, -18991, -18950, -18909, -18868, -18827, -18786, -18745, -18704, -18662, -18621, -18580, -18538, -18497, -18455, -18414, -18372, -18330, -18289, -18247, -18205, -18163, -18121, -18080, -18038, -17996, -17954, -17912, -17869, -17827, -17785, -17743, -17701, -17658, -17616, -17573, -17531, -17489, -17446, -17403, -17361, -17318, -17275, -17233, -17190, -17147, -17104, -17061, -17018, -16976, -16933, -16889, -16846, -16803, -16760, -16717, -16674, -16630, -16587, -16544, -16500, -16457, -16413, -16370, -16326, -16283, -16239, -16195, -16152, -16108, -16064, -16020, -15976, -15932, -15888, -15844, -15800, -15756, -15712, -15668, -15624, -15580, -15536, -15491, -15447, -15403, -15358, -15314, -15269, -15225, -15180, -15136, -15091, -15047, -15002, -14957, -14912, -14868, -14823, -14778, -14733, -14688, -14643, -14598, -14553, -14508, -14463, -14418, -14373, -14328, -14282, -14237, -14192, -14147, -14101, -14056, -14010, -13965, -13919, -13874, -13828, -13783, -13737, -13692, -13646, -13600, -13554, -13509, -13463, -13417, -13371, -13325, -13279, -13233, -13187, -13141, -13095, -13049, -13003, -12957, -12911, -12864, -12818, -12772, -12726, -12679, -12633, -12587, -12540, -12494, -12447, -12401, -12354, -12308, -12261, -12214, -12168, -12121, -12074, -12027, -11981, -11934, -11887, -11840, -11793, -11746, -11700, -11653, -11606, -11559, -11511, -11464, -11417, -11370, -11323, -11276, -11229, -11181, -11134, -11087, -11040, -10992, -10945, -10897, -10850, -10803, -10755, -10708, -10660, -10613, -10565, -10517, -10470, -10422, -10374, -10327, -10279, -10231, -10184, -10136, -10088, -10040, -9992, -9944, -9896, -9849, -9801, -9753, -9705, -9657, -9609, -9560, -9512, -9464, -9416, -9368, -9320, -9272, -9223, -9175, -9127, -9079, -9030, -8982, -8934, -8885, -8837, -8788, -8740, -8692, -8643, -8595, -8546, -8498, -8449, -8400, -8352, -8303, -8255, -8206, -8157, -8109, -8060, -8011, -7962, -7914, -7865, -7816, -7767, -7718, -7669, -7621, -7572, -7523, -7474, -7425, -7376, -7327, -7278, -7229, -7180, -7131, -7082, -7033, -6984, -6934, -6885, -6836, -6787, -6738, -6689, -6639, -6590, -6541, -6492, -6442, -6393, -6344, -6294, -6245, -6196, -6146, -6097, -6048, -5998, -5949, -5899, -5850, -5800, -5751, -5702, -5652, -5602, -5553, -5503, -5454, -5404, -5355, -5305, -5256, -5206, -5156, -5107, -5057, -5007, -4958, -4908, -4858, -4808, -4759, -4709, -4659, -4610, -4560, -4510, -4460, -4410, -4361, -4311, -4261, -4211, -4161, -4111, -4061, -4012, -3962, -3912, -3862, -3812, -3762, -3712, -3662, -3612, -3562, -3512, -3462, -3412, -3362, -3312, -3262, -3212, -3162, -3112, -3062, -3012, -2962, -2912, -2862, -2812, -2762, -2712, -2662, -2611, -2561, -2511, -2461, -2411, -2361, -2311, -2261, -2210, -2160, -2110, -2060, -2010, -1960, -1909, -1859, -1809, -1759, -1709, -1659, -1608, -1558, -1508, -1458, -1407, -1357, -1307, -1257, -1207, -1156, -1106, -1056, -1006, -955, -905, -855, -805, -754, -704, -654, -604, -553, -503, -453, -403, -352, -302, -252, -202, -151, -101, -51
};
#endif

static inline int16_t synth_table(uint32_t phase)
{
#ifdef SYNTH_SINE
  return sine_table[phase >> 20] >> (4 + SYNTH_EXTRA_SHIFT);
#else
  return (phase < (1u << 31) ?
      (int32_t)((1u << 31) + phase * 2) :
      (int32_t)(((1u << 31) - 1) - (phase - (1u << 31)) * 2)
    ) >> (16 /* Max. range */ + 4 /* Avoid clipping with polyphony 10 */ + SYNTH_EXTRA_SHIFT);
#endif
}

#ifdef SYNTH_STEREO
  #define N_CH 2
#else
  #define N_CH 1
#endif
static inline void synth_audio(int16_t *buf, uint32_t count)
{
  memset(buf, 0, count * sizeof(int16_t));
  for (int i = 0; i < 10; i++) if (keys[i].state != 0) {
    int j = 0;
    while (j < count && keys[i].state != 0) {
      if (__builtin_expect(keys[i].state == 1, 0)) {
        for (; j < count; j += N_CH) {
          int16_t value = synth_table(keys[i].phase += keys[i].freq);
          keys[i].time += SYNTH_ATTACK_INCR;
          if (__builtin_expect(keys[i].time >= (1 << 15), 0)) {
            buf[j] += value;
            keys[i].state = 2;
            j += N_CH;
            break;
          } else {
            buf[j] += ((int32_t)value * keys[i].time) >> 15;
          }
        }
      } else if (__builtin_expect(keys[i].state == 3, 0)) {
        for (; j < count; j += N_CH) {
          int16_t value = synth_table(keys[i].phase += keys[i].freq);
          keys[i].time += SYNTH_RELEASE_INCR;
          if (__builtin_expect(keys[i].time >= (1 << 15), 0)) {
            keys[i].state = 0;
            j += N_CH;
            break;
          } else {
            buf[j] += ((int32_t)value * ((1 << 15) - keys[i].time)) >> 15;
          }
        }
      } else {
        for (; j < count; j += N_CH) {
          int16_t value = synth_table(keys[i].phase += keys[i].freq);
          buf[j] += value;
        }
      }
    }
  }
}
#undef N_CH

static inline void synth_buttons(bool btn[12])
{
  for (int i = 11; i >= 0; i--) {
    if (btn[i] && !last_btn[i]) {
      // Press
      if (i < 10) {
        int transpose = 0;
        if (btn[10]) { transpose -= 1; transp_used[0] = true; }
        if (btn[11]) { transpose += 1; transp_used[1] = true; }
        keys[i].freq = freq_for_note(scale_base + i, key_base, transpose);
        keys[i].phase = 0;
        keys[i].state = 1;
        keys[i].time = 0;
      } else {
        transp_used[i - 10] = false;
      }
    } else if (!btn[i] && last_btn[i]) {
      // Release
      if (i < 10) {
        keys[i].state = 3;
        keys[i].time = 0;
      } else {
        // If no note has been pressed during the hold,
        // carry out a global transposition
        if (!transp_used[i - 10]) {
          if (btn[i ^ 1]) {
            // Key change
            key_base += (i == 10 ? -1 : +1);
            if (key_base < -12) key_base = -12;
            if (key_base >  12) key_base =  12;
            transp_used[(i - 10) ^ 1] = true;
          } else {
            // Scale base change
            scale_base += (i == 10 ? -1 : +1);
            if (scale_base < -18) scale_base = -18;
            if (scale_base >  14) scale_base =  14;
          }
        }
      }
    }
    last_btn[i] = btn[i];
  }
}
